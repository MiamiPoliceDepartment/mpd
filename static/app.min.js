"use strict";var app={answered:["intro"],suspects:[],count:0,tip:{timestamp:"",category:"",when:"",where:"",details:"",suspect_1:"",suspect_2:"",suspect_3:"",suspect_4:"",suspect_5:""}};function Suspect(){this.gender="",this.weapons="",this.name="",this.aliases="",this.age="",this.skin="",this.height="",this.weight="",this.hair_length="",this.hair_type="",this.hair_color="",this.facial_hair="",this.marks="",this.eyes="",this.glasses="",this.location="",this.location_time="",this.children="",this.dogs="",this.gang="",this.social_media="",this.drug_activity="",this.drug_type="",this.vehicle_make="",this.vehicle_model="",this.vehicle_type="",this.vehicle_color="",this.vehicle_age="",this.vehicle_marks="",this.vehicle_tag=""}function resetTextAreas(a){a.querySelector("textarea")&&(a.querySelector("textarea").value="")}function addButtonListeners(){for(var a=document.querySelectorAll("button:not(.submit)"),b=0,c=a.length;b<c;b++)a[b].addEventListener("click",function(d){if("back"==d.target.id)previousQuestion();else{d.preventDefault;var f=d.target.parentNode;handleSelection(d.target.value,f.id)}})}function addSubmitListeners(){for(var a=document.querySelectorAll(".submit"),b=0,c=a.length;b<c;b++)a[b].addEventListener("click",function(d){d.preventDefault;var f=d.target.parentNode,g=f.querySelector("textarea");handleSelection(g.value.replace("\n",""),f.id)})}function addTextareaListeners(){for(var a=document.querySelectorAll("textarea"),b=0,c=a.length;b<c;b++)a[b].addEventListener("keyup",function(d){var f=d.target,g=f.parentNode,h=f.getAttribute("maxlength");f.style.color=f.value.length>h-3?"red":"inherit","Enter"==d.key&&handleSelection(f.value.replace("\n",""),g.id)})}function toggleBackButton(){var a=document.querySelector("#back");1<app.answered.length&&"end"!=app.answered[app.answered.length-1]?a.classList.remove("hidden"):a.classList.add("hidden")}function nextQuestion(a){setTimeout(function(){var b=document.querySelector("#"+a);if(b.classList.remove("hidden"),b.querySelector("textarea")){var c=b.querySelector("textarea");c.focus()}document.querySelector("#"+app.answered[app.answered.length-1]).classList.add("hidden"),app.answered.push(a),resetTextAreas(b),toggleBackButton()},250)}function previousQuestion(){("another_suspect"==app.answered[app.answered.length-2]||"who"==app.answered[app.answered.length-2]||"tip"==app.answered[app.answered.length-2])&&"gender"==app.answered[app.answered.length-1]&&(app.suspects.pop(),0<app.count&&(app.count-=1)),setTimeout(function(){document.querySelector("#"+app.answered.pop()).classList.add("hidden");var a=document.querySelector("#"+app.answered[app.answered.length-1]);a.classList.remove("hidden"),toggleBackButton()},250)}function setGenderPronouns(a){for(var b={male:["he","his","him"],female:["she","her","her"],unknown:["this suspect","this suspect's","this suspect"]},c=document.querySelectorAll(".pronoun-subject"),d=document.querySelectorAll(".pronoun-possessive"),f=document.querySelectorAll(".pronoun-object"),g=0,h=c.length;g<h;g++)c[g].innerText=b[a][0];for(var g=0,h=d.length;g<h;g++)d[g].innerText=b[a][1];for(var g=0,h=f.length;g<h;g++)f[g].innerText=b[a][2]}function setSuspectOrdinal(){document.querySelector("#suspect-ordinal").innerText={1:"second",2:"third",3:"fourth",4:"fifth"}[app.suspects.length]}function setName(a){for(var b=document.querySelectorAll(".suspect-name"),c=0,d=b.length;c<d;c++)b[c].innerText=a}function handleSelection(a,b){return{intro:function(f){"emergency"==f?nextQuestion("emergency"):nextQuestion("tip")},emergency:function(f){f&&(window.location.href="tel:911")},tip:function(f){"fugitive"==f?(app.tip.category="Fugitive",app.suspects[app.count]=new Suspect,nextQuestion("gender")):"drugs"==f?(app.tip.category="Narcotics",nextQuestion("who")):nextQuestion("violent_crime")},violent_crime:function(f){"assault"==f?nextQuestion("robbery"):f?(app.tip.category="homicide"==f?"Homicide":"Sexual Assault",nextQuestion("when")):nextQuestion("property_crime")},robbery:function(f){f?(app.tip.category=f,nextQuestion("when")):nextQuestion("domestic_violence")},domestic_violence:function(f){app.tip.category=f,nextQuestion("when")},property_crime:function(f){"stolen"==f?nextQuestion("burglary"):"damaged"==f?nextQuestion("arson"):nextQuestion("economic_crime")},burglary:function(f){app.tip.category=f,nextQuestion("when")},arson:function(f){app.tip.category=f,nextQuestion("when")},economic_crime:function(f){f?(app.tip.category=f,nextQuestion("when")):nextQuestion("sex_crime")},sex_crime:function(f){f?(app.tip.category=f,nextQuestion("when")):nextQuestion("hit_and_run")},hit_and_run:function(f){f?nextQuestion("fatalities"):nextQuestion("when")},fatalities:function(f){app.tip.category=f?"fatal hit and run":"hit and run",nextQuestion("dui")},dui:function(f){f&&(app.tip.category=app.tip.crime.category+" (DUI)"),nextQuestion("when")},when:function(f){f?"prompt"==f?nextQuestion("when_prompt"):(f=new Date().toISOString().slice(0,10),app.tip.when=f,nextQuestion("where")):nextQuestion("where")},when_prompt:function(f){f&&(app.tip.when=f),nextQuestion("where")},where:function(f){f?nextQuestion("where_prompt"):nextQuestion("who")},where_prompt:function(f){f&&(app.tip.where=f),nextQuestion("who")},misc:function(f){f?nextQuestion("misc_prompt"):nextQuestion("submit")},misc_prompt:function(f){f&&(app.tip.details=f),nextQuestion("submit")},who:function(f){f?(app.suspects[app.count]=new Suspect,nextQuestion("gender")):nextQuestion("misc")},gender:function(f){app.suspects[app.count].gender=f,setGenderPronouns(f),setSuspectOrdinal(),"Narcotics"==app.tip.category?nextQuestion("drug_activity"):nextQuestion("name")},drug_activity:function(f){app.suspects[app.count].drug_activity=f,nextQuestion("drug_type")},drug_type:function(f){"prompt"==f?nextQuestion("drug_type_prompt"):(app.suspects[app.count].drug_type=f,nextQuestion("name"))},drug_type_prompt:function(f){f&&(app.suspects[app.count].drug_type=f,nextQuestion("name"))},name:function(f){f?nextQuestion("name_prompt"):nextQuestion("alias")},name_prompt:function(f){app.suspects[app.count].name=f,f&&setName(f),nextQuestion("alias")},alias:function(f){f?nextQuestion("alias_prompt"):nextQuestion("age")},alias_prompt:function(f){app.suspects[app.count].aliases=f,nextQuestion("age")},age:function(f){app.suspects[app.count].age=f,nextQuestion("ethnicity")},ethnicity:function(f){"other"==f?nextQuestion("ethnicity_other"):(app.suspects[app.count].ethnicity=f,nextQuestion("skin"))},ethnicity_other:function(f){"prompt"==f?nextQuestion("ethnicity_prompt"):(app.suspects[app.count].ethnicity=f,nextQuestion("skin"))},ethnicity_prompt:function(f){app.suspects[app.count].ethnicity=f,nextQuestion("skin")},skin:function(f){app.suspects[app.count].skin=f,nextQuestion("height")},height:function(f){app.suspects[app.count].height=f,nextQuestion("weight")},weight:function(f){app.suspects[app.count].weight=f,nextQuestion("hair")},hair:function(f){"yes"==f?nextQuestion("hair_length"):"no"==f?(app.suspects[app.count].hair="shaved or bald","male"==app.suspects[app.count].gender?nextQuestion("facial_hair"):nextQuestion("marks")):nextQuestion("marks")},hair_length:function(f){app.suspects[app.count].hair=f,nextQuestion("hair_color")},hair_color:function(f){"prompt"==f?nextQuestion("hair_color_prompt"):(app.suspects[app.count].hair_color=f,nextQuestion("hair_type"))},hair_color_prompt:function(f){app.suspects[app.count].hair_color=f,nextQuestion("hair_type")},hair_type:function(f){app.suspects[app.count].hair_type=f,"male"==app.suspects[app.count].gender?nextQuestion("facial_hair"):nextQuestion("marks")},facial_hair:function(f){app.suspects[app.count].facial_hair=f,nextQuestion("eyes")},eyes:function(f){"other"==f?nextQuestion("eyes_other"):(app.suspects[app.count].eyes=f,nextQuestion("glasses"))},eyes_other:function(f){app.suspects[app.count].eyes=f,nextQuestion("glasses")},glasses:function(f){app.suspects[app.count].glasses=f,nextQuestion("marks")},marks:function(f){"prompt"==f?nextQuestion("marks_prompt"):nextQuestion("armed")},marks_prompt:function(f){app.suspects[app.count].marks=f,nextQuestion("armed")},armed:function(f){app.suspects[app.count].weapons=f,nextQuestion("gang_member")},gang_member:function(f){f?nextQuestion("gang_name"):nextQuestion("suspect_location")},gang_name:function(f){"prompt"==f?nextQuestion("gang_name_prompt"):(app.suspects[app.count].gang="unknown",nextQuestion("suspect_location"))},gang_name_prompt:function(f){app.suspects[app.count].gang=f,nextQuestion("suspect_location")},suspect_location:function(f){"prompt"==f?nextQuestion("suspect_location_prompt"):nextQuestion("social_media")},suspect_location_prompt:function(f){app.suspects[app.count].location=f,nextQuestion("suspect_location_time")},suspect_location_time:function(f){app.suspects[app.count].location_time=f,nextQuestion("children")},children:function(f){app.suspects[app.count].dogs=f,nextQuestion("dogs")},dogs:function(f){app.suspects[app.count].dogs=f,nextQuestion("social_media")},social_media:function(f){"prompt"==f?nextQuestion("social_media_prompt"):nextQuestion("vehicle")},social_media_prompt:function(f){app.suspects[app.count].social_media=f,nextQuestion("vehicle")},vehicle:function(f){f?nextQuestion("vehicle_make"):nextQuestion("another_suspect")},vehicle_make:function(f){"prompt"==f?nextQuestion("vehicle_make_select"):nextQuestion("vehicle_type")},vehicle_make_select:function(f){"prompt"==f?nextQuestion("vehicle_make_prompt"):nextQuestion(f)},vehicle_make_1:function(f){app.suspects[app.count].vehicle_make=f,nextQuestion("vehicle_model")},vehicle_make_2:function(f){app.suspects[app.count].vehicle_make=f,nextQuestion("vehicle_model")},vehicle_make_3:function(f){app.suspects[app.count].vehicle_make=f,nextQuestion("vehicle_model")},vehicle_make_4:function(f){app.suspects[app.count].vehicle_make=f,nextQuestion("vehicle_model")},vehicle_make_5:function(f){app.suspects[app.count].vehicle_make=f,nextQuestion("vehicle_model")},vehicle_make_6:function(f){app.suspects[app.count].vehicle_make=f,nextQuestion("vehicle_model")},vehicle_make_prompt:function(f){app.suspects[app.count].vehicle_make=f,nextQuestion("vehicle_model")},vehicle_model:function(f){"prompt"==f?nextQuestion("vehicle_model_prompt"):nextQuestion("vehicle_type")},vehicle_model_prompt:function(f){app.suspects[app.count].vehicle_model=f,nextQuestion("vehicle_age")},vehicle_type:function(f){app.suspects[app.count].vehicle_type=f,nextQuestion("vehicle_age")},vehicle_age:function(f){app.suspects[app.count].vehicle_age=f,nextQuestion("vehicle_color")},vehicle_color:function(f){"other"==f?nextQuestion("vehicle_color_other"):(app.suspects[app.count].vehicle_color=f,nextQuestion("vehicle_marks"))},vehicle_color_other:function(f){"prompt"==f?nextQuestion("vehicle_color_prompt"):(app.suspects[app.count].vehicle_color=f,nextQuestion("vehicle_marks"))},vehicle_color_prompt:function(f){app.suspects[app.count].vehicle_color=f,nextQuestion("vehicle_marks")},vehicle_marks:function(f){"prompt"==f?nextQuestion("vehicle_marks_prompt"):nextQuestion("vehicle_tag")},vehicle_marks_prompt:function(f){app.suspects[app.count].vehicle_marks=f,nextQuestion("vehicle_tag")},vehicle_tag:function(f){"prompt"==f?nextQuestion("vehicle_tag_prompt"):nextQuestion("another_suspect")},vehicle_tag_prompt:function(f){app.suspects[app.count].vehicle_tag=f,5>app.suspects.length?nextQuestion("another_suspect"):nextQuestion("misc")},another_suspect:function(f){0<app.suspects.length&&parseSuspect(app.suspects[app.count]),f?(app.count+=1,app.suspects[app.count]=new Suspect,nextQuestion("gender")):nextQuestion("misc")},submit:function(f){if(f){var g=new Date,h=g.getFullYear()+"-"+(g.getMonth()+1)+"-"+g.getDate(),j=g.getHours()+":"+g.getMinutes()+":"+g.getSeconds();app.tip.timestamp=h+" "+j,console.log(app.tip),submitForm(app.tip),nextQuestion("end")}},end:function(f){"new"==f?(app={answered:["end"],suspects:[],count:0,tip:{timestamp:"",category:"",when:"",where:"",details:"",suspect_1:"",suspect_2:"",suspect_3:"",suspect_4:"",suspect_5:""}},nextQuestion("tip")):window.location="http://www.miami-police.org"}}[b](a)}function parseSuspect(a){var b="",c="Suspect",d="Suspect's";"male"==a.gender?(c="He",d="His"):"female"==a.gender&&(c="She",d="Her"),a.drug_activity&&(b+="Suspect is allegedly involved in",b+=a.drug_type?" "+a.drug_type:" drug",b+=" "+a.drug_activity+". "),(a.skin||a.age||a.gender||a.ethnicity)&&(b+="Suspect is a",a.skin&&(b+=" "+a.skin+"-skinned"),a.age&&(b+=" "+a.age),b+="unknown"==a.gender?" individual (gender unknown)":" "+a.gender,a.ethnicity&&(b+=" of "+a.ethnicity+" descent"),b+="."),(a.height||a.weight)&&(b+=" "+c+" is",a.height&&("average"==a.height?b+=" average height":b+=" "+a.height),a.height&&a.weight&&(b+=" and"),a.weight&&("average"==a.weight?b+=" average weight":b+=" "+a.weight),b+="."),a.hair_length&&("shaved or bald"==a.hair_length?b+=" "+d+" head is shaved or bald.":b+=" "+c+" has "+a.hair_length+", "+a.hair_type+", "+a.hair_color+" hair."),a.facial_hair&&("clean-shaven"==a.facial_hair?b+=" "+d+" face is "+a.facial_hair+".":b+=" "+c+" has "+a.facial_hair+"."),(a.eyes||a.glasses)&&(b+=" "+c,a.eyes&&(b+=" has "+a.eyes+" eyes"),a.eyes&&a.glasses&&(b+=" and"),a.glasses&&(b+=" wears glasses"),b+="."),a.marks&&(b+=" "+c+" has the following identifying marks: "+a.marks+"."),a.name&&(b+=" "+d+" legal name is: "+a.name+"."),a.aliases&&(b+=" "+c+" uses the following alias(es): "+a.aliases+"."),"unknown"==a.gang?b+=" "+c+" is a gang member.":a.gang&&(b+=" "+d+" gang affiliation is: "+a.gang+"."),a.weapons&&(b+=" "+c+" is armed with a "+a.weapons+"."),a.location&&(b+=" "+c+" may be found at: "+a.location+".",a.location_time&&(b+=" "+c+" is usually there between "+a.location_time+"."),a.children&&a.dogs?b+=" There are children and dogs at this location.":a.children?b+=" There are children at this location.":a.dogs&&(b+=" There are dogs at this location.")),a.social_media&&(b+=" "+d+" social media info is: "+a.social_media+"."),(a.vehicle_make||a.vehicle_type)&&(b+="  "+c+" drives a",a.vehicle_color&&(b+=" "+a.vehicle_color),a.vehicle_age&&(b+=" "+a.vehicle_age),a.vehicle_make&&(b+=" "+a.vehicle_make),a.vehicle_model&&(b+=" "+a.vehicle_model),a.vehicle_type&&(b+=" "+a.vehicle_type),b+=".",a.vehicle_marks&&(b+=" The vehicle has the following features: "+a.vehicle_marks+"."),a.vehicle_tag&&(b+=" Its tag number is: "+a.vehicle_tag+".")),b=b.replace(" a a"," an a").replace(" a e"," an e").replace(" a i"," an i").replace(" a o"," an o").replace(" a u"," a(n) u").replace(" a A"," an A").replace(" a E"," an E").replace(" a I"," an I").replace(" a O"," an O").replace(" a U"," a(n) U").replace("..","."),0==app.count?app.tip.suspect_1=b:1==app.count?app.tip.suspect_2=b:2==app.count?app.tip.suspect_3=b:3==app.count?app.tip.suspect_4=b:app.tip.suspect_5=b}function submitForm(a){var b=new XMLHttpRequest;b.open("POST","./tip"),b.setRequestHeader("Content-Type","application/json; charset=UTF-8"),b.send(JSON.stringify(a)),b.onloadend=function(){console.log("Sent!")}}window.onbeforeunload=function(a){var b="Are you sure? Your answers will be lost. (Use the 'Back' button to return to a previous question.)";return a.returnValue=b,b},addButtonListeners(),addSubmitListeners(),addTextareaListeners();